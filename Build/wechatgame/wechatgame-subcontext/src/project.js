window.__require=function e(o,n,t){function r(c,s){if(!n[c]){if(!o[c]){var i=c.split("/");if(i=i[i.length-1],!o[i]){var l="function"==typeof __require&&__require;if(!s&&l)return l(i,!0);if(a)return a(i,!0);throw new Error("Cannot find module '"+c+"'")}}var f=n[c]={exports:{}};o[c][0].call(f.exports,function(e){return r(o[c][1][e]||e)},f,f.exports,e,o,n,t)}return n[c].exports}for(var a="function"==typeof __require&&__require,c=0;c<t.length;c++)r(t[c]);return r}({OpenCommon:[function(e,o,n){"use strict";cc._RF.push(o,"7ab32OHYWpBS7cbtmam5P1W","OpenCommon"),Object.defineProperty(n,"__esModule",{value:!0});var t=function(){function e(){}return e.localStorageMap=new Map,e}();n.OpenCommon=t,cc._RF.pop()},{}],launch:[function(e,o,n){"use strict";cc._RF.push(o,"ca4b9VB3alCN6vjaIjw3pSB","launch");var t=e("./OpenCommon");cc.Class({extends:cc.Component,properties:{content:cc.Node,prefab:cc.Prefab},start:function(){var e=this;this.rank=0,wx.onMessage(function(o){o&&o.message&&(console.info("[\u5b50\u57df\u6536\u5230\u6d88\u606f]"+o.message),e.resolveMessage(o.message))})},createUserBlock:function(e){var o=this.createPrefab(),n=void 0,t=void 0,r=void 0;e&&(n=e.nickName?e.nickName:e.nickname,t=e.avatarUrl,r=this.resolveCloudStorage(e.KVDataList,"OneEatMaxScore"));var a=o.getChildByName("rank").getComponent(cc.Label),c=o.getChildByName("userName").getComponent(cc.Label),s=o.getChildByName("mask").children[0].getComponent(cc.Sprite),i=o.getChildByName("userScore").getComponent(cc.Label);if(n){if(r)switch(this.rank+=1,a.string=this.rank,this.rank){case 1:a.node.color=new cc.Color(255,0,0);break;case 2:a.node.color=new cc.Color(0,255,0);break;case 3:a.node.color=new cc.Color(0,0,255);break;default:a.fontSize=a.fontSize/2}else r="null",a.string="null";c.string=n,i.string=r,console.log("[\u83b7\u53d6\u597d\u53cb\u4fe1\u606f]"+n),t&&cc.loader.load({url:t,type:"png"},function(e,o){e&&console.error(e),s.spriteFrame=new cc.SpriteFrame(o)}),o.on(cc.Node.EventType.TOUCH_START,function(){console.info("[\u70b9\u51fb\u533a\u57571]"+c.string+"[\u5206\u6570]"+i.string)},this)}else c.string="",i.string="",s.spriteFrame="",a.string=""},createPrefab:function(){var e=cc.instantiate(this.prefab);return e.parent=this.content,e},resolveMessage:function(e){switch(console.info("[\u6307\u4ee4]"+e.type),e.type){case"command":this.resolveCommand(e.function,e.arguments,e.data)}},resolveCommand:function(e,o,n){var r=this;switch(console.info("[\u6307\u4ee4]"+e+"[\u53c2\u6570]"+o+"[\u6570\u636e]"+n),e){case"start":new Promise(function(e){r.clearContext(),r.getUserInfo(function(o){e(o)}),n&&n.width&&n.height&&(console.info("[\u4fee\u6b63\u5206\u8fa8\u7387]"+n.width+","+n.height),r.getComponent(cc.Canvas).designResolution=new cc.size(n.width,n.height))}).then(function(e){console.info("[\u662f\u5426\u5f97\u5230\u7528\u6237\u4fe1\u606f]"+e),r.getFriendInfo(["OneEatMaxScore"])});break;case"switch":switch(this.clearContext(),o){case"friend":this.getFriendInfo(["OneEatMaxScore"]);break;case"group":n?(console.info("[\u6839\u636e]"+n+"[\u83b7\u53d6\u7fa4\u7ec4\u4fe1\u606f]"),this.getGroupInfo(n,["OneEatMaxScore"])):console.info("[\u65e0\u6cd5\u83b7\u53d6\u7fa4\u7ec4\u4fe1\u606f]")}break;case"save":switch(o){case"gameDiamond":console.info("[\u5b58\u50a8\u6e38\u620f\u94bb\u77f3]"+n);break;case"gameCurrency":console.info("[\u5b58\u50a8\u6e38\u620f\u5e01]"+n);break;case"score":console.info("[\u5b58\u50a8\u5206\u6570]"+n),n>t.OpenCommon.maxScore&&(console.info("[\u65b0\u7684\u6700\u9ad8\u5206\u6570]"+n),this.saveMaxScoreData(n));break;case"shareTicket":console.info("[\u5b58\u50a8\u7fa4\u8bc6\u522b\u7801]"+n)}}},clearContext:function(){this.rank=0,this.content.removeAllChildren(),console.info("[\u6e05\u7406\u5bb9\u5668]")},getUserInfo:function(e){var o=this;t.OpenCommon.userInfo?e(!0):wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(n){var r=n.data[0];t.OpenCommon.userInfo=r,console.info("[\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u6210\u529f]"+r),o.getUserMaxScoreData(function(n){var t=r.nickName,a=r.avatarUrl,c=n;if(o.userBlock){var s=o.userBlock.getChildByName("Mask").getComponentInChildren(cc.Sprite),i=o.userBlock.getChildByName("Name").getComponent(cc.Label),l=o.userBlock.getChildByName("Score").getComponent(cc.Label);i.string=t,cc.loader.load({url:a,type:"png"},function(e,o){e&&console.error(e),s.spriteFrame=new cc.SpriteFrame(o)}),l.string=c?n:"null"}e(!0)})},fail:function(o){console.info("[\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25]"+o),e(!1)}})},getFriendInfo:function(e){var o=this,n=void 0;if(t.OpenCommon.localStorageMap.has("Friend")){var r=t.OpenCommon.localStorageMap.get("Friend");n=[];for(var a=0;a<e.length;a++)if(r.has(e[a])){console.info("[\u4ece\u7f13\u5b58\u83b7\u53d6\u597d\u53cb\u6258\u7ba1\u6570\u636e]"+e[a]);var c=r.get(e[a]);o.createInfoBlock(c,10)}else n.push(e[a])}else n=e;n.length>0&&(console.info("[\u5f00\u59cb\u83b7\u53d6\u597d\u53cb\u6258\u7ba1\u6570\u636e]"+n),wx.getFriendCloudStorage({keyList:e,success:function(e){console.info("[\u6210\u529f\u83b7\u53d6\u670b\u53cb\u4fe1\u606f]",e.data);var n=o.resolveInfo("Friend","OneEatMaxScore",e.data);o.createInfoBlock(n,10)},fail:function(e){console.error(e)}}))},resolveInfo:function(e,o,n){this.sortList(n,o,!1);var r=void 0;return t.OpenCommon.localStorageMap.has(e)?r=t.OpenCommon.localStorageMap.get(e):(r=new Map,t.OpenCommon.localStorageMap.set(e,r),console.info("[\u521b\u5efa\u6570\u636e\u7f13\u5b58]"+r)),r.set(o,n),n},createInfoBlock:function(e,o){for(var n=0;n<o;n++){var t=e[n];t?this.createUserBlock(t):this.createUserBlock()}},getGroupInfo:function(e,o){var n=this,r=void 0;if(t.OpenCommon.localStorageMap.has("Group")){var a=t.OpenCommon.localStorageMap.get("Group");r=[];for(var c=0;c<o.length;c++)if(a.has(o[c])){console.info("[\u4ece\u7f13\u5b58\u83b7\u53d6\u7fa4\u7ec4\u6258\u7ba1\u6570\u636e]"+o[c]);var s=a.get(o[c]);n.createInfoBlock(s,10)}else r.push(o[c])}else r=o;r.length>0&&(console.info("[\u5f00\u59cb\u83b7\u53d6\u597d\u53cb\u6258\u7ba1\u6570\u636e]"+r),wx.getGroupCloudStorage({shareTicket:e,keyList:o,success:function(e){console.info("[\u6210\u529f\u83b7\u53d6\u7fa4\u7ec4\u4fe1\u606f]",e.data);var o=n.resolveInfo("Group","OneEatMaxScore",e.data);n.createInfoBlock(o,10)},fail:function(e){console.error(e)}}))},getUserMaxScoreData:function(e){var o=this,n=new Array;n.push("OneEatMaxScore"),wx.getUserCloudStorage({keyList:n,success:function(n){console.info("[\u83b7\u53d6\u7528\u6237\u6258\u7ba1\u6570\u636e\u6210\u529f]"+n.KVDataList.length);var r=o.resolveCloudStorage(n.KVDataList,"OneEatMaxScore");r?(console.info("[\u83b7\u53d6\u6258\u7ba1\u6700\u9ad8\u5206\u6210\u529f]"),t.OpenCommon.maxScore=r,e(r)):(o.saveMaxScoreData(0),e(0)),t.OpenCommon.isGetMaxScoreSuccess=!0},fail:function(o){console.info("[\u83b7\u53d6\u6258\u7ba1\u6570\u636e\u5931\u8d25]"),t.OpenCommon.isGetMaxScoreSuccess=!1,e(0)}})},resolveCloudStorage:function(e,o){if(!e)return null;console.log("[\u6258\u7ba1\u6570\u636e\u6570\u91cf]"+e.length);for(var n=0;n<e.length;n++)if(e[n].key===o)return e[n].value},saveCloudStorage:function(e,o,n){wx.setUserCloudStorage({KVDataList:e,success:o,fail:n})},saveMaxScoreData:function(e){var o=new Array;o.push({key:"OneEatMaxScore",value:""+e}),this.saveCloudStorage(o,function(){console.info("[\u5b58\u50a8\u6700\u9ad8\u5206\u6570\u636e\u6210\u529f]")},function(){console.info("[\u5b58\u50a8\u6700\u9ad8\u5206\u6570\u636e\u5931\u8d25]")})},sortList:function(e,o,n){return e.sort(function(e,t){for(var r=0,a=e.KVDataList,c=0;c<a.length;c++)a[c].key==o&&(r=a[c].value);var s=0;a=t.KVDataList;for(var i=0;i<a.length;i++)a[i].key==o&&(s=a[i].value);return n?parseInt(r)-parseInt(s):parseInt(s)-parseInt(r)}),e}}),cc._RF.pop()},{"./OpenCommon":"OpenCommon"}]},{},["OpenCommon","launch"]);
//# sourceMappingURL=project.js.map